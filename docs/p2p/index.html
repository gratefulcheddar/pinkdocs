



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.2">
    
    
      
        <title>P2P Network - PinkDocs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.9b572555.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Lato","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="pink" data-md-color-accent="pink">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#constants-and-defaults" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="PinkDocs" class="md-header-nav__button md-logo">
          
            <img src="../img/PinkLogo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                PinkDocs
              </span>
              <span class="md-header-nav__topic">
                P2P Network
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

<nav class="md-tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href=".." title="Introduction" class="md-tabs__link md-tabs__link--active">
        Introduction
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../img/PinkLogo.svg" width="24" height="24">
      
    </span>
    PinkDocs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../block-chain/" title="Blockchain" class="md-nav__link">
      Blockchain
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../transactions/" title="Transactions" class="md-nav__link">
      Transactions
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        P2P Network
      </label>
    
    <a href="./" title="P2P Network" class="md-nav__link md-nav__link--active">
      P2P Network
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#constants-and-defaults" title="Constants And Defaults" class="md-nav__link">
    Constants And Defaults
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol-versions" title="Protocol Versions" class="md-nav__link">
    Protocol Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-headers" title="Message Headers" class="md-nav__link">
    Message Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-messages" title="Data Messages" class="md-nav__link">
    Data Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block" title="Block" class="md-nav__link">
    Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getblocks" title="GetBlocks" class="md-nav__link">
    GetBlocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getdata" title="GetData" class="md-nav__link">
    GetData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getheaders" title="GetHeaders" class="md-nav__link">
    GetHeaders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" title="Headers" class="md-nav__link">
    Headers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inv" title="Inv" class="md-nav__link">
    Inv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mempool" title="MemPool" class="md-nav__link">
    MemPool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tx" title="Tx" class="md-nav__link">
    Tx
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-messages" title="Control Messages" class="md-nav__link">
    Control Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addr" title="Addr" class="md-nav__link">
    Addr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getaddr" title="GetAddr" class="md-nav__link">
    GetAddr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ping" title="Ping" class="md-nav__link">
    Ping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pong" title="Pong" class="md-nav__link">
    Pong
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verack" title="VerAck" class="md-nav__link">
    VerAck
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version" title="Version" class="md-nav__link">
    Version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="Pinkcoin API" class="md-nav__link">
      Pinkcoin API
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#constants-and-defaults" title="Constants And Defaults" class="md-nav__link">
    Constants And Defaults
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#protocol-versions" title="Protocol Versions" class="md-nav__link">
    Protocol Versions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#message-headers" title="Message Headers" class="md-nav__link">
    Message Headers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-messages" title="Data Messages" class="md-nav__link">
    Data Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#block" title="Block" class="md-nav__link">
    Block
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getblocks" title="GetBlocks" class="md-nav__link">
    GetBlocks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getdata" title="GetData" class="md-nav__link">
    GetData
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getheaders" title="GetHeaders" class="md-nav__link">
    GetHeaders
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#headers" title="Headers" class="md-nav__link">
    Headers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inv" title="Inv" class="md-nav__link">
    Inv
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mempool" title="MemPool" class="md-nav__link">
    MemPool
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tx" title="Tx" class="md-nav__link">
    Tx
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-messages" title="Control Messages" class="md-nav__link">
    Control Messages
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addr" title="Addr" class="md-nav__link">
    Addr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getaddr" title="GetAddr" class="md-nav__link">
    GetAddr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ping" title="Ping" class="md-nav__link">
    Ping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pong" title="Pong" class="md-nav__link">
    Pong
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verack" title="VerAck" class="md-nav__link">
    VerAck
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#version" title="Version" class="md-nav__link">
    Version
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>P2P Network</h1>
                
                <p>This section describes the Pinkcoin P2P network protocol (but it is not a
specification).</p>
<p>All peer-to-peer communication occurs entirely over TCP.</p>
<p><strong>Note:</strong> unless their description says otherwise, all multi-byte
integers mentioned in this section are transmitted in little-endian order.</p>
<h2 id="constants-and-defaults">Constants And Defaults</h2>
<table>
<thead>
<tr>
<th>Network</th>
<th>Default Port</th>
<th>Start String</th>
<th>Max nBits</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mainnet</td>
<td>9134</td>
<td>f2f4f9fb</td>
<td>-</td>
</tr>
<tr>
<td>Testnet</td>
<td>19134</td>
<td>0204050d</td>
<td>-</td>
</tr>
</tbody>
</table>
<p>Command line parameters can change what port a node listens on (see
<code>-help</code>). Start strings are hardcoded constants that appear at the start
of all messages sent on the Pinkcoin network; they may also appear in
data files such as Pinkcoin's block database.  The nBits displayed
above are in big-endian order; they're sent over the network in
little-endian order.</p>
<h2 id="protocol-versions">Protocol Versions</h2>
<p>The table below lists some notable versions of the P2P network protocol,
with the most recent versions listed first. (If you know of a protocol
version that implemented a major change but which is not listed here,
please open an issue.)</p>
<p>As of Pinkcoin v2.1.0.4 , the most recent protocol version is 60014.</p>
<table>
<thead>
<tr>
<th>Version</th>
<th>Initial Release</th>
<th>Major Changes</th>
</tr>
</thead>
<tbody>
<tr>
<td>60014</td>
<td>Pinkcoin v2.1.0.3</td>
<td>Hardforking Network Attack Bug-fix (<a href="https://medium.com/@cryptocayce/incident-pinkcoin-network-attack-9f6bbe5048b6">Details</a>)</td>
</tr>
</tbody>
</table>
<h2 id="message-headers">Message Headers</h2>
<p>All messages in the network protocol use the same container format,
which provides a required multi-field message header and an optional payload.
The message header format is:</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>start string</td>
<td>char[4]</td>
<td>Magic bytes indicating the originating network; used to seek to next message when stream state is unknown.</td>
</tr>
<tr>
<td>12</td>
<td>command name</td>
<td>char[12]</td>
<td>ASCII string which identifies what message type is contained in the payload.  Followed by nulls (0x00) to pad out byte count; for example: <code>version\0\0\0\0\0</code>.</td>
</tr>
<tr>
<td>4</td>
<td>payload size</td>
<td>uint32_t</td>
<td>Number of bytes in payload.  The current maximum number of bytes (<code>MAX_SIZE</code>) allowed in the payload by Bitcoin Core is 32 MiB---messages with a payload size larger than this will be dropped or rejected.</td>
</tr>
<tr>
<td>4</td>
<td>checksum</td>
<td>char[4]</td>
<td><br><br>First 4 bytes of SHA256(SHA256(payload)) in internal byte order.<br /><br /> If payload is empty, as in <code>verack</code> and <code>getaddr</code> messages, the checksum is always 0x5df6e0e2 (SHA256(SHA256(\<empty string>))).</td>
</tr>
</tbody>
</table>
<p>The following example is an annotated hex dump of a mainnet message
header from a <code>verack</code> message which has no payload.</p>
<pre><code>f2f4f9fb ................... Start string: Mainnet
76657261636b000000000000 ... Command name: verack + null padding
00000000 ................... Byte count: 0
5df6e0e2 ................... Checksum: SHA256(SHA256(&lt;empty&gt;))
</code></pre>

<h2 id="data-messages">Data Messages</h2>
<p>The following network messages all request or provide data related to
transactions and blocks.</p>
<p><img alt="Overview Of P2P Protocol Data Request And Reply Messages" src="../img/en-p2p-data-messages.svg" /></p>
<p>Many of the data messages use
inventories as unique identifiers
for transactions and blocks.  Inventories have a simple 36-byte
structure:</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>type identifier</td>
<td>uint32_t</td>
<td>The type of object which was hashed.  See list of type identifiers below.</td>
</tr>
<tr>
<td>32</td>
<td>hash</td>
<td>char[32]</td>
<td>SHA256(SHA256()) hash of the object in internal byte order.</td>
</tr>
</tbody>
</table>
<p>The currently-available type identifiers are:</p>
<table>
<thead>
<tr>
<th>Type Identifier</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>MSG_TX</code></td>
<td>The hash is a TXID.</td>
</tr>
<tr>
<td>2</td>
<td><code>MSG_BLOCK</code></td>
<td>The hash is of a block header.</td>
</tr>
</tbody>
</table>
<p>Type identifier zero and type identifiers greater than two are reserved
for future implementations. Pinkcoin ignores all inventories with
one of these unknown types.</p>
<h3 id="block">Block</h3>
<p>The <code>block</code> message transmits a single serialized block in the format
described in the <a href="../block-chain/#serialized-blocks">serialized blocks section</a>.
See that section for an example hexdump.  It can be sent for two
different reasons:</p>
<ol>
<li>
<p><strong>GetData Response:</strong> Nodes will always send it in response to a
   <code>getdata</code> message that requests the block with an inventory
   type of <code>MSG_BLOCK</code> (provided the node has that block available for
   relay).</p>
</li>
<li>
<p><strong>Unsolicited:</strong> Some miners will send unsolicited <code>block</code> messages
   broadcasting their newly-mined blocks to all of their peers. Many
   mining pools do the same thing, although some may be misconfigured to
   send the block from multiple nodes, possibly sending the same block
   to some peers more than once.</p>
</li>
</ol>
<h3 id="getblocks">GetBlocks</h3>
<p>The <code>getblocks</code> message requests an <code>inv</code> message that provides block
header hashes starting from a particular point in the block chain. It
allows a peer which has been disconnected or started for the first time
to get the data it needs to request the blocks it hasn't seen.</p>
<p>Peers which have been disconnected may have stale blocks in their
locally-stored block chain, so the <code>getblocks</code> message allows the
requesting peer to provide the receiving peer with multiple header
hashes at various heights on their local chain. This allows the
receiving peer to find, within that list, the last header hash they had
in common and reply with all subsequent header hashes.</p>
<p>Note: the receiving peer itself may respond with an <code>inv</code> message
containing header hashes of stale blocks.  It is up to the requesting
peer to poll all of its peers to find the best block chain.</p>
<p>If the receiving peer does not find a common header hash within the
list, it will assume the last common block was the genesis block (block
zero), so it will reply with in <code>inv</code> message containing header hashes
starting with block one (the first block after the genesis block).</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>version</td>
<td>uint32_t</td>
<td>The protocol version number; the same as sent in the <code>version</code> message.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>hash count</td>
<td>compactSize uint</td>
<td>The number of header hashes provided not including the stop hash.  There is no limit except that the byte size of the entire message must be below the <code>MAX_SIZE</code> limit; typically from 1 to 200 hashes are sent.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>block header hashes</td>
<td>char[32]</td>
<td>One or more block header hashes (32 bytes each) in internal byte order.  Hashes should be provided in reverse order of block height, so highest-height hashes are listed first and lowest-height hashes are listed last.</td>
</tr>
<tr>
<td>32</td>
<td>stop hash</td>
<td>char[32]</td>
<td>The header hash of the last header hash being requested; set to all zeroes to request an <code>inv</code> message with all subsequent header hashes (a maximum of 500 will be sent as a reply to this message; if you need more than 500, you will need to send another <code>getblocks</code> message with a higher-height header hash as the first entry in block header hash field).</td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <code>getblocks</code> message.  (The
message header has been omitted.)</p>
<pre><code>71110100 ........................... Protocol version: 70001
02 ................................. Hash count: 2

d39f608a7775b537729884d4e6633bb2
105e55a16a14d31b0000000000000000 ... Hash #1

5c3e6403d40837110a2e8afb602b1c01
714bda7ce23bea0a0000000000000000 ... Hash #2

00000000000000000000000000000000
00000000000000000000000000000000 ... Stop hash
</code></pre>

<h3 id="getdata">GetData</h3>
<p>The <code>getdata</code> message requests one or more data objects from another
node. The objects are requested by an inventory, which the requesting
node typically received previously by way of an <code>inv</code> message.</p>
<p>The response to a <code>getdata</code> message can be a <code>tx</code> message, <code>block</code>
message, <code>merkleblock</code> message, or <code>notfound</code> message.</p>
<p>This message cannot be used to request arbitrary data, such as historic
transactions no longer in the memory pool or relay set. Full nodes may
not even be able to provide older blocks if they've pruned old
transactions from their block database. For this reason, the <code>getdata</code>
message should usually only be used to request data from a node which
previously advertised it had that data by sending an <code>inv</code> message.</p>
<p>The format and maximum size limitations of the <code>getdata</code> message are
identical to the <code>inv</code> message; only the message header differs.</p>
<h3 id="getheaders">GetHeaders</h3>
<p>The <code>getheaders</code> message requests a <code>headers</code> message that provides block headers
starting from a particular point in the block chain. It allows a
peer which has been disconnected or started for the first time to get
the headers it hasn’t seen yet.</p>
<p>The <code>getheaders</code> message is nearly identical to the <code>getblocks</code> message,
with one minor difference: the <code>inv</code> reply to the <code>getblocks</code> message
will include no more than 500 block header hashes; the <code>headers</code> reply
to the <code>getheaders</code> message will include as many as 2,000 block headers.</p>
<h4 id="headers">Headers</h4>
<p>The <code>headers</code> message sends block headers to a node which
previously requested certain headers with a <code>getheaders</code> message. A headers
message can be empty.</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Varies</em></td>
<td>count</td>
<td>compactSize uint</td>
<td>Number of block headers up to a maximum of 2,000.  Note: headers-first sync assumes the sending node will send the maximum number of headers whenever possible.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>headers</td>
<td>block_header</td>
<td>Block headers: each 80-byte block header is in the format described in the <a href="../block-chain/#block-headers">block headers section</a> with an additional 0x00 suffixed.  This 0x00 is called the transaction count, but because the headers message doesn't include any transactions, the transaction count is always zero.</td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <code>headers</code> message.  (The message
header has been omitted.)</p>
<pre><code>01 ................................. Header count: 1

02000000 ........................... Block version: 2
b6ff0b1b1680a2862a30ca44d346d9e8
910d334beb48ca0c0000000000000000 ... Hash of previous block's header
9d10aa52ee949386ca9385695f04ede2
70dda20810decd12bc9b048aaab31471 ... Merkle root
24d95a54 ........................... Unix time: 1415239972
30c31b18 ........................... Target (bits)
fe9f0864 ........................... Nonce

00 ................................. Transaction count (0x00)
</code></pre>

<h3 id="inv">Inv</h3>
<p>The <code>inv</code> message (inventory message) transmits one or more inventories of
objects known to the transmitting peer.  It can be sent unsolicited to
announce new transactions or blocks, or it can be sent in reply to a
<code>getblocks</code> message or <code>mempool</code> message.</p>
<p>The receiving peer can compare the inventories from an <code>inv</code> message
against the inventories it has already seen, and then use a follow-up
message to request unseen objects.</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Varies</em></td>
<td>count</td>
<td>compactSize uint</td>
<td>The number of inventory entries.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>inventory</td>
<td>inventory</td>
<td>One or more inventory entries up to a maximum of 50,000 entries.</td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows an <code>inv</code> message with two
inventory entries.  (The message header has been omitted.)</p>
<pre><code>02 ................................. Count: 2

01000000 ........................... Type: MSG_TX
de55ffd709ac1f5dc509a0925d0b1fc4
42ca034f224732e429081da1b621f55a ... Hash (TXID)

01000000 ........................... Type: MSG_TX
91d36d997037e08018262978766f24b8
a055aaf1d872e94ae85e9817b2c68dc7 ... Hash (TXID)
</code></pre>

<h3 id="mempool">MemPool</h3>
<p>The <code>mempool</code> message requests the TXIDs of transactions that the
receiving node has verified as valid but which have not yet appeared in
a block. That is, transactions which are in the receiving node's memory
pool. The response to the <code>mempool</code> message is one or more <code>inv</code>
messages containing the TXIDs in the usual inventory format.</p>
<p>Sending the <code>mempool</code> message is mostly useful when a program first
connects to the network. Full nodes can use it to quickly gather most or
all of the unconfirmed transactions available on the network; this is
especially useful for miners trying to gather transactions for their
transaction fees. SPV clients can set a filter before sending a
<code>mempool</code> to only receive transactions that match that filter; this
allows a recently-started client to get most or all unconfirmed
transactions related to its wallet.</p>
<p>The <code>inv</code> response to the <code>mempool</code> message is, at best, one node's
view of the network---not a complete list of unconfirmed transactions
on the network. Here are some additional reasons the list might not
be complete:</p>
<ul>
<li>
<p>Before Bitcoin Core 0.9.0, the response to the <code>mempool</code> message was
  only one <code>inv</code> message. An <code>inv</code> message is limited to 50,000
  inventories, so a node with a memory pool larger than 50,000 entries
  would not send everything.  Later versions of Bitcoin Core send as
  many <code>inv</code> messages as needed to reference its complete memory pool.</p>
</li>
<li>
<p>The <code>mempool</code> message is not currently fully compatible with the
  <code>filterload</code> message's <code>BLOOM_UPDATE_ALL</code> and
  <code>BLOOM_UPDATE_P2PUBKEY_ONLY</code> flags. Mempool transactions are not
  sorted like in-block transactions, so a transaction (tx2) spending an
  output can appear before the transaction (tx1) containing that output,
  which means the automatic filter update mechanism won't operate until
  the second-appearing transaction (tx1) is seen---missing the
  first-appearing transaction (tx2). It has been proposed in [Bitcoin
  Core issue #2381][] that the transactions should be sorted before
  being processed by the filter.</p>
</li>
</ul>
<p>There is no payload in a <code>mempool</code> message.  See the [message header
section][section message header] for an example of a message without a payload.</p>
<h3 id="tx">Tx</h3>
<p>The <code>tx</code> message transmits a single transaction in the raw transaction
format. It can be sent in a variety of situations;</p>
<ul>
<li>
<p><strong>Transaction Response:</strong> Bitcoin Core and BitcoinJ will send it in
  response to a <code>getdata</code> message that requests the transaction with an
  inventory type of <code>MSG_TX</code>.</p>
</li>
<li>
<p><strong>MerkleBlock Response:</strong> Bitcoin Core will send it in response to a
  <code>getdata</code> message that requests a merkle block with an inventory type
  of <code>MSG_MERKLEBLOCK</code>. (This is in addition to sending a <code>merkleblock</code>
  message.) Each <code>tx</code> message in this case provides a matched
  transaction from that block.</p>
</li>
<li>
<p><strong>Unsolicited:</strong> BitcoinJ will send a <code>tx</code> message unsolicited for
  transactions it originates.</p>
</li>
</ul>
<p>For an example hexdump of the raw transaction format, see the <a href="#raw-transaction-format">raw
transaction section</a>.</p>
<h2 id="control-messages">Control Messages</h2>
<p>The following network messages all help control the connection between
two peers or allow them to advise each other about the rest of the
network.</p>
<p><img alt="Overview Of P2P Protocol Control And Advisory Messages" src="../img/en-p2p-control-messages.svg" /></p>
<p>Note that almost none of the control messages are authenticated in any
way, meaning they can contain incorrect or intentionally harmful
information. In addition, this section does not yet cover P2P protocol
operation over the Tor network; if you would like to contribute
information about Tor, please open an issue.</p>
<h3 id="addr">Addr</h3>
<p>The <code>addr</code> (IP address) message relays connection information
for peers on the network. Each peer which wants to accept incoming
connections creates an <code>addr</code> message providing its connection
information and then sends that message to its peers unsolicited. Some
of its peers send that information to their peers (also unsolicited),
some of which further distribute it, allowing decentralized peer
discovery for any program already on the network.</p>
<p>An <code>addr</code> message may also be sent in response to a <code>getaddr</code> message.</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>Varies</em></td>
<td>IP address count</td>
<td>compactSize uint</td>
<td>The number of IP address entries up to a maximum of 1,000.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>IP addresses</td>
<td>network IP address</td>
<td>IP address entries.  See the table below for the format of a Bitcoin network IP address.</td>
</tr>
</tbody>
</table>
<p>Each encapsulated network IP address currently uses the following structure:</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>time</td>
<td>uint32</td>
<td><em>Added in protocol version 31402.</em> <br><br>A time in Unix epoch time format.  Nodes advertising their own IP address set this to the current time.  Nodes advertising IP addresses they've connected to set this to the last time they connected to that node.  Other nodes just relaying the IP address should not change the time.  Nodes can use the time field to avoid relaying old <code>addr</code> messages.  <br><br>Malicious nodes may change times or even set them in the future.</td>
</tr>
<tr>
<td>8</td>
<td>services</td>
<td>uint64_t</td>
<td>The services the node advertised in its <code>version</code> message.</td>
</tr>
<tr>
<td>16</td>
<td>IP address</td>
<td>char</td>
<td>IPv6 address in <strong>big endian byte order</strong>. IPv4 addresses can be provided as IPv4-mapped IPv6 addresses</td>
</tr>
<tr>
<td>2</td>
<td>port</td>
<td>uint16_t</td>
<td>Port number in <strong>big endian byte order</strong>.  Note that Bitcoin Core will only connect to nodes with non-standard port numbers as a last resort for finding peers.  This is to prevent anyone from trying to use the network to disrupt non-Bitcoin services that run on other ports.</td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows part of an <code>addr</code> message. (The
message header has been omitted and the actual IP address has been
replaced with a RFC5737 reserved IP address.)</p>
<pre><code>fde803 ............................. Address count: 1000

d91f4854 ........................... Epoch time: 1414012889
0100000000000000 ................... Service bits: 01 (network node)
00000000000000000000ffffc0000233 ... IP Address: ::ffff:192.0.2.51
208d ............................... Port: 8333

[...] .............................. (999 more addresses omitted)
</code></pre>

<h3 id="getaddr">GetAddr</h3>
<p>The <code>getaddr</code> message requests an <code>addr</code> message from the receiving
node, preferably one with lots of IP addresses of other receiving nodes.
The transmitting node can use those IP addresses to quickly update its
database of available nodes rather than waiting for unsolicited <code>addr</code>
messages to arrive over time.</p>
<p>There is no payload in a <code>getaddr</code> message.  See the [message header
section][section message header] for an example of a message without a payload.</p>
<h3 id="ping">Ping</h3>
<p>The <code>ping</code> message helps confirm that the receiving peer is still
connected. If a TCP/IP error is encountered when sending the <code>ping</code>
message (such as a connection timeout), the transmitting node can assume
that the receiving node is disconnected. The response to a <code>ping</code>
message is the <code>pong</code> message.</p>
<p>Before protocol version 60000, the <code>ping</code> message had no payload. As of
protocol version 60001 and all later versions, the message includes a
single field, the nonce.</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>8</td>
<td>nonce</td>
<td>uint64_t</td>
<td><em>Added in protocol version 60001 as described by BIP31.</em> <br><br>Random nonce assigned to this <code>ping</code> message.  The responding <code>pong</code> message will include this nonce to identify the <code>ping</code> message to which it is replying.</td>
</tr>
</tbody>
</table>
<p>The annotated hexdump below shows a <code>ping</code> message. (The message
header has been omitted.)</p>
<pre><code>0094102111e2af4d ... Nonce
</code></pre>

<h3 id="pong">Pong</h3>
<p><em>Added in protocol version 60001 as described by BIP31.</em></p>
<p>The <code>pong</code> message replies to a <code>ping</code> message, proving to the pinging
node that the ponging node is still alive. Bitcoin Core will, by
default, disconnect from any clients which have not responded to a
<code>ping</code> message within 20 minutes.</p>
<p>To allow nodes to keep track of latency, the <code>pong</code> message sends back
the same nonce received in the <code>ping</code> message it is replying to.</p>
<p>The format of the <code>pong</code> message is identical to the <code>ping</code> message;
only the message header differs.</p>
<h3 id="verack">VerAck</h3>
<p><em>Added in protocol version 209.</em></p>
<p>The <code>verack</code> message acknowledges a previously-received <code>version</code>
message, informing the connecting node that it can begin to send
other messages. The <code>verack</code> message has no payload; for an example
of a message with no payload, see the [message headers
section][section message header].</p>
<h3 id="version">Version</h3>
<p>The <code>version</code> message provides information about the transmitting node
to the receiving node at the beginning of a connection. Until both peers
have exchanged <code>version</code> messages, no other messages will be accepted.</p>
<p>If a <code>version</code> message is accepted, the receiving node should send a
<code>verack</code> message---but no node should send a <code>verack</code> message
before initializing its half of the connection by first sending a
<code>version</code> message.</p>
<table>
<thead>
<tr>
<th>Bytes</th>
<th>Name</th>
<th>Data Type</th>
<th>Required/Optional</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>4</td>
<td>version</td>
<td>int32_t</td>
<td>Required</td>
<td>The highest protocol version understood by the transmitting node.  See the [protocol version section][section protocol versions].</td>
</tr>
<tr>
<td>8</td>
<td>services</td>
<td>uint64_t</td>
<td>Required</td>
<td>The services supported by the transmitting node encoded as a bitfield.  See the list of service codes below.</td>
</tr>
<tr>
<td>8</td>
<td>timestamp</td>
<td>int64_t</td>
<td>Required</td>
<td>The current Unix epoch time according to the transmitting node's clock.  Because nodes will reject blocks with timestamps more than two hours in the future, this field can help other nodes to determine that their clock is wrong.</td>
</tr>
<tr>
<td>8</td>
<td>addr_recv services</td>
<td>uint64_t</td>
<td>Required</td>
<td>The services supported by the receiving node as perceived by the transmitting node.  Same format as the 'services' field above. Bitcoin Core will attempt to provide accurate information.  BitcoinJ will, by default, always send 0.</td>
</tr>
<tr>
<td>16</td>
<td>addr_recv IP address</td>
<td>char</td>
<td>Required</td>
<td>The IPv6 address of the receiving node as perceived by the transmitting node in <strong>big endian byte order</strong>. IPv4 addresses can be provided as [IPv4-mapped IPv6 addresses][]. Bitcoin Core will attempt to provide accurate information.  BitcoinJ will, by default, always return ::ffff:127.0.0.1</td>
</tr>
<tr>
<td>2</td>
<td>addr_recv port</td>
<td>uint16_t</td>
<td>Required</td>
<td>The port number of the receiving node as perceived by the transmitting node in <strong>big endian byte order</strong>.</td>
</tr>
<tr>
<td>8</td>
<td>addr_trans services</td>
<td>uint64_t</td>
<td>Required</td>
<td><em>Added in protocol version 106.</em> <br><br>The services supported by the transmitting node.  Should be identical to the 'services' field above.</td>
</tr>
<tr>
<td>16</td>
<td>addr_trans IP address</td>
<td>char</td>
<td>Required</td>
<td><em>Added in protocol version 106.</em> <br><br>The IPv6 address of the transmitting node in <strong>big endian byte order</strong>. IPv4 addresses can be provided as [IPv4-mapped IPv6 addresses][].  Set to ::ffff:127.0.0.1 if unknown.</td>
</tr>
<tr>
<td>2</td>
<td>addr_trans port</td>
<td>uint16_t</td>
<td>Required</td>
<td><em>Added in protocol version 106.</em> <br><br>The port number of the transmitting node in <strong>big endian byte order</strong>.</td>
</tr>
<tr>
<td>8</td>
<td>nonce</td>
<td>uint64_t</td>
<td>Required</td>
<td><em>Added in protocol version 106.</em> <br><br>A random nonce which can help a node detect a connection to itself.  If the nonce is 0, the nonce field is ignored.  If the nonce is anything else, a node should terminate the connection on receipt<!--noref--> of a <code>version</code> message with a nonce it previously sent.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>user_agent bytes</td>
<td>compactSize uint</td>
<td>Required</td>
<td><em>Added in protocol version 106.</em> <br><br>Number of bytes in following user_agent field.  If 0x00, no user agent field is sent.</td>
</tr>
<tr>
<td><em>Varies</em></td>
<td>user_agent</td>
<td>string</td>
<td>Required if user_agent bytes &gt; 0</td>
<td><em>Added in protocol version 106. Renamed in protocol version 60000.</em> <br><br>User agent as defined by BIP14. Previously called subVer.</td>
</tr>
<tr>
<td>4</td>
<td>start_height</td>
<td>int32_t</td>
<td>Required</td>
<td><em>Added in protocol version 209.</em> <br><br>The height of the transmitting node's best block chain or, in the case of an SPV client, best block header chain.</td>
</tr>
<tr>
<td>1</td>
<td>relay</td>
<td>bool</td>
<td>Optional</td>
<td><em>Added in protocol version 70001 as described by BIP37.</em> <br><br>Transaction relay flag.  If 0x00, no <code>inv</code> messages or <code>tx</code> messages announcing new transactions should be sent to this client until it sends a <code>filterload</code> message or <code>filterclear</code> message.  If the relay field is not present or is set to 0x01, this node wants <code>inv</code> messages and <code>tx</code> messages announcing new transactions.</td>
</tr>
</tbody>
</table>
<p>The following service identifiers have been assigned.</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00</td>
<td><em>Unnamed</em></td>
<td>This node is not a full node.  It may not be able to provide any data except for the transactions it originates.</td>
</tr>
<tr>
<td>0x01</td>
<td>NODE_NETWORK</td>
<td>This is a full node and can be asked for full blocks.  It should implement all protocol features available in its self-reported protocol version.</td>
</tr>
</tbody>
</table>
<p>The following annotated hexdump shows a <code>version</code> message. (The
message header has been omitted and the actual IP addresses have been
replaced with [RFC5737][] reserved IP addresses.)</p>
<pre><code>72110100 ........................... Protocol version: 70002
0100000000000000 ................... Services: NODE_NETWORK
bc8f5e5400000000 ................... Epoch time: 1415483324

0100000000000000 ................... Receiving node's services
00000000000000000000ffffc61b6409 ... Receiving node's IPv6 address
208d ............................... Receiving node's port number

0100000000000000 ................... Transmitting node's services
00000000000000000000ffffcb0071c0 ... Transmitting node's IPv6 address
208d ............................... Transmitting node's port number

128035cbc97953f8 ................... Nonce

0f ................................. Bytes in user agent string: 15
2f5361746f7368693a302e392e332f ..... User agent: /Satoshi:0.9.3/

cf050500 ........................... Start height: 329167
01 ................................. Relay flag: true
</code></pre>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../transactions/" title="Transactions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Transactions
              </span>
            </div>
          </a>
        
        
          <a href="../api/" title="Pinkcoin API" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Pinkcoin API
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a46cbbdf.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:".."}})</script>
      
        <script src="../search/require.js"></script>
      
        <script src="../search/search.js"></script>
      
    
    
      
    
  </body>
</html>